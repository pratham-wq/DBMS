CREATE TABLE CONSTITUENCY(
    CONSTID INT PRIMARY KEY,
    NAME VARCHAR(30),
    STATE VARCHAR(30),
    NOOFVOTERS INT
);

INSERT INTO CONSTITUENCY VALUES(1,'BANGALORE','KARNATAKA',2);
INSERT INTO CONSTITUENCY VALUES(2,'SHIMOGA','KARNATAKA',2);
INSERT INTO CONSTITUENCY VALUES(3,'HYDARABAD','TELANGANA',3);

CREATE TABLE PARTY(
    PID INT PRIMARY KEY,
    PNAME VARCHAR(30),
    SYMBOL VARCHAR(30)
);

INSERT INTO PARTY VALUES(1,'CONGRESS','PALM');
INSERT INTO PARTY VALUES(2,'BJP','LOTUS');


CREATE TABLE CANDIDATE(
    CANDID INT PRIMARY KEY,
    NAME VARCHAR(30),
    PNO VARCHAR(30),
    AGE INT,
    STATE VARCHAR(30),
    PID INT REFERENCES PARTY(PID)
);

INSERT INTO CANDIDATE VALUES(1,'AMAR','8660639260',35,'KARNATAKA',1);
INSERT INTO CANDIDATE VALUES(2,'ANTONY','8660639262',37,'TELANGANA',2);

CREATE TABLE VOTERS(
    VID INT,
    NAME VARCHAR(30),
    AGE VARCHAR(30),
    ADDRESS VARCHAR(150),
    CONSTID INT REFERENCES CONSTITUENCY(CONSTID),
    CANDID INT REFERENCES CANDIDATE(CANDID)
);

INSERT INTO VOTERS VALUES(1,'ABHI',20,'1 BALKI BIDAR KARNATAKA 577001',1,1);
INSERT INTO VOTERS VALUES(2,'ARIF',20,'1 BHADRAVATHI BHADRAVATHI KARNATAKA 577201',2,2);
INSERT INTO VOTERS VALUES(3,'MANOJ',18,'1 ANAVERI SHIMOGA KARNATAKA 577243',1,2);


CREATE TABLE CONTEST(
    CONSTID INT REFERENCES CONSTITUENCY(CONSTID),
    CANDID INT REFERENCES CANDIDATE(CANDID)
);

INSERT INTO CONTEST VALUES(1,1);
INSERT INTO CONTEST VALUES(2,2);
INSERT INTO CONTEST VALUES(3,1);


****************** Queries ************************

i.  List the details of the candidates who are contesting from more than one 
    constituencies which are belongs to different states.

SELECT * 
FROM CANDIDATE 
WHERE CANDID IN (  
    SELECT CANDID  
    FROM CONTEST CT, CONSTITUENCY CS 
    WHERE CT.CONSTID = CS.CONSTID 
    GROUP BY CANDID 
    HAVING COUNT(DISTINCT(STATE))>1 
);



ii. Display the state name having maximum number of constituencies.

SELECT STATE FROM CONSTITUENCY 
GROUP BY STATE 
HAVING COUNT(STATE) = ( 
    SELECT MAX(COUNTS) FROM ( 
		SELECT COUNT(*) COUNTS 
		FROM CONSTITUENCY 
		GROUP BY STATE) COUNTER 
);



iii. Create a stored procedure to insert the tuple into the voter table by checking the voter age. If voter's age is at least 18 years old, then insert the tuple into the voter else display the "Not an eligible voter msg".


CREATE OR REPLACE PROCEDURE CHECKAGE(ID IN NUMBER,AGE IN NUMBER) 
AS 
BEGIN 
    IF AGE>=18 THEN 
        INSERT INTO VOTERS(VID,AGE)VALUES(ID,AGE); 
    ELSE 
        DBMS_OUTPUT.PUT_LINE('NOT AN ELIGIBLE VOTER'); 
    END IF; 
END; 
/

SQL> SET SERVEROUTPUT ON;
SQL> EXEC CHECKAGE(4,17);
SQL> EXEC CHECKAGE(3,22);



iv. Create a stored procedure to display the number_of_voters in the specified constituency. 
    Where the constituency name is passed as an argument to the stored procedure.


CREATE OR REPLACE PROCEDURE COUNTVOTERS(CNAME IN VARCHAR)  
AS 
	CNT INTEGER; 
BEGIN 
	SELECT NOOFVOTERS INTO CNT   
    FROM CONSTITUENCY  
    WHERE NAME = CNAME; 
	DBMS_OUTPUT.PUT_LINE ( 'TOTAL VOTERS ARE: ' || CNT); 
END; 
/

CALL CHECKAGE(5,12)

v. Create a TRIGGER to UPDATE the count of "Number_of_voters" of the respective constituency  in "CONSTITUENCY" table , AFTER inserting a tuple into the "VOTERS" table.


CREATE OR REPLACE TRIGGER UPDATECOUNT 
AFTER INSERT ON VOTERS 
FOR EACH ROW 
BEGIN 
UPDATE CONSTITUENCY 
SET NOOFVOTERS = NOOFVOTERS + 1 
WHERE CONSTID=:NEW.CONSTID; 
END; 
/ 

INSERT INTO VOTERS VALUES(10,'AKSHAY',22,'1 BALKI BIDAR KARNATAKA 577002',1,1);
