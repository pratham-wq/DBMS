CREATE TABLE BRANCH( 
    BRANCHID INT PRIMARY KEY, 
    BRANCHNAME VARCHAR(30), 
    HOD VARCHAR(30) 
);

INSERT INTO BRANCH VALUES (1,'MCA','AMAR');
INSERT INTO BRANCH VALUES (2,'MBA','AKBAR');
INSERT INTO BRANCH VALUES (3,'MTECH','ANTONY');


CREATE TABLE STUDENT(
	USN VARCHAR(30) PRIMARY KEY,
	NAME VARCHAR(30),
	ADDRESS VARCHAR(30),
	BRANCHID INT REFERENCES BRANCH(BRANCHID),
	SEM INT
);

INSERT INTO STUDENT VALUES ('1001','LOKESH','BANGALORE',1,2);
INSERT INTO STUDENT VALUES ('1002','AKSHAY','BANGALORE',1,2);
INSERT INTO STUDENT VALUES ('1003','MANOJ','BANGALORE',2,1);
INSERT INTO STUDENT VALUES ('1004','AMITH','SHIMOGA',3,1);
INSERT INTO STUDENT VALUES ('1005','ABHI','BANGALORE',1,2);

CREATE TABLE AUTHOR(
	AUTHORID INT PRIMARY KEY,
	AUTHORNAME VARCHAR(30), 
	COUNTRY VARCHAR(30),
	AGE INT
);

INSERT INTO AUTHOR VALUES (1,'DENNIS','US',56);
INSERT INTO AUTHOR VALUES (2,'RAMAKRISHNA','INDIA',56);
INSERT INTO AUTHOR VALUES (3,'JAMES','US',56);
INSERT INTO AUTHOR VALUES (4,'RITCHE','UK',56);



CREATE TABLE BOOK(
	BOOKID INT PRIMARY KEY,
	BOOKNAME VARCHAR(30),
	AUTHORID INT REFERENCES AUTHOR(AUTHORID),
	PUBLISHER VARCHAR(30),
	BRANCHID INT REFERENCES BRANCH(BRANCHID)
);

INSERT INTO BOOK VALUES(1,'JAVA',1,'PEARSON',1);
INSERT INTO BOOK VALUES(2,'C',1,'MC HILL',1);
INSERT INTO BOOK VALUES(3,'C++',2,'PEARSON',1);
INSERT INTO BOOK VALUES(4,'DBMS',3,'PEARSON',2);
INSERT INTO BOOK VALUES(5,'OS',4,'PEARSON',3);

CREATE TABLE BORROW(
	USN VARCHAR(20) REFERENCES STUDENT(USN),
	BOOKID INT REFERENCES BOOK(BOOKID),
	BORROW_DATE DATE
);

INSERT INTO BORROW VALUES ('1001',1,'12-JAN-2021');
INSERT INTO BORROW VALUES ('1001',2,'12-JAN-2021');
INSERT INTO BORROW VALUES ('1001',3,'12-JAN-2021');
INSERT INTO BORROW VALUES ('1002',1,'12-JAN-2021');
INSERT INTO BORROW VALUES ('1003',4,'12-JAN-2021');
INSERT INTO BORROW VALUES ('1003',5,'12-JAN-2021');


*******************  Queries *********************************

i. List the details of Students who are all studying in 2nd sem MCA

SELECT * FROM STUDENT 
WHERE SEM = 2 AND BRANCHID IN (
	SELECT BRANCHID 
	FROM BRANCH 
	WHERE BRANCHNAME = 'MCA'
);


ii. List the students who are not borrowed any books

SELECT * FROM STUDENT 
WHERE USN NOT IN(
	SELECT USN 
	FROM BORROW
);


iii. Display the USN, Student name, Branch_name, Book_name, Author_name, Books_Borrowed_Date of 2nd sem MCA Students who borrowed books

SELECT S.USN, S.NAME, B.BRANCHNAME, BK.BOOKNAME, A.AUTHORNAME, BW.BORROW_DATE 
FROM STUDENT S 
JOIN BORROW BW ON S.USN = BW.USN  
JOIN BOOK BK ON BK.BOOKID = BW.BOOKID  
JOIN AUTHOR A ON BK.AUTHORID = A.AUTHORID  
JOIN BRANCH B ON S.BRANCHID = B.BRANCHID  
WHERE S.SEM = 2  
  AND B.BRANCHNAME = 'MCA'; 


iv. Display the number of books written by each Author.

SELECT AUTHORNAME, COUNT(*) FROM BOOK B, AUTHOR A 
WHERE B.AUTHORID = A.AUTHORID 
GROUP BY AUTHORNAME;


v. Display the student details who borrowed more than two books.

SELECT * FROM STUDENT 
WHERE USN IN(SELECT USN FROM BORROW GROUP BY USN HAVING COUNT(USN) >2 );


vi. Display the student details who borrowed books of more than one Author.

SELECT * 
FROM STUDENT WHERE USN IN(
	SELECT USN 
	FROM BORROW BW, BOOK B 
	WHERE BW.BOOKID = B.BOOKID 
	GROUP BY USN 
	HAVING COUNT(DISTINCT AUTHORID) >1
);



vii.Display the Book names in descending order of their names.

SELECT BOOKNAME 
FROM BOOK 
ORDER BY BOOKNAME DESC;


viii. List the details of students who borrowed the books which are all published by the same publisher.

SELECT * 
FROM STUDENT WHERE USN IN( 
	SELECT USN  FROM BORROW B, BOOK BK 
	WHERE B.BOOKID = BK.BOOKID 
	GROUP BY USN 
	HAVING COUNT(DISTINCT PUBLISHER) =1 
);
